<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>White Dwarf Papers Tracker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 10px 15px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
        }
        
        .control-group label {
            color: white;
            font-weight: 500;
        }
        
        .control-group input, .control-group select {
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            background: rgba(255,255,255,0.9);
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255,107,107,0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255,107,107,0.4);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
            color: #ffd700;
        }
        
        .stat-card p {
            opacity: 0.9;
        }
        
        .map-container {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        #map {
            height: 500px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .legend {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .legend h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            border: 2px solid #333;
        }
        
        .loading {
            text-align: center;
            color: white;
            font-size: 1.2rem;
            margin: 50px 0;
        }
        
        .error {
            background: rgba(255,0,0,0.1);
            border: 1px solid rgba(255,0,0,0.3);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .paper-popup {
            max-width: 300px;
        }
        
        .paper-popup h4 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }
        
        .paper-popup p {
            margin: 5px 0;
            font-size: 12px;
        }
        
        .citation-badge {
            background: #4a90e2;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŒŸ White Dwarf Papers Tracker</h1>
            <p>Exploring stellar remnants research from around the world</p>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label for="yearRange">Year Range:</label>
                <select id="yearRange">
                    <option value="2024-2024">2024</option>
                    <option value="2023-2024">2023-2024</option>
                    <option value="2020-2024" selected>2020-2024</option>
                    <option value="2015-2024">2015-2024</option>
                    <option value="2010-2024">2010-2024</option>
                </select>
            </div>
            <div class="control-group">
                <label for="minCitations">Min Citations:</label>
                <input type="number" id="minCitations" value="0" min="0">
            </div>
            <button class="btn" onclick="fetchPapers()">ðŸ”„ Update Data</button>
        </div>
        
        <div class="stats">
            <div class="stat-card">
                <h3 id="totalPapers">0</h3>
                <p>Total Papers</p>
            </div>
            <div class="stat-card">
                <h3 id="totalInstitutions">0</h3>
                <p>Institutions</p>
            </div>
            <div class="stat-card">
                <h3 id="totalCitations">0</h3>
                <p>Total Citations</p>
            </div>
            <div class="stat-card">
                <h3 id="avgCitations">0</h3>
                <p>Avg Citations</p>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <div class="legend">
            <h3>Legend - Citation Ranges</h3>
            <div class="legend-item">
                <div class="legend-circle" style="background: #ff4757; width: 8px; height: 8px;"></div>
                <span>0-9 citations</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #ffa502; width: 12px; height: 12px;"></div>
                <span>10-49 citations</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #3742fa; width: 16px; height: 16px;"></div>
                <span>50-99 citations</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #2ed573; width: 20px; height: 20px;"></div>
                <span>100+ citations</span>
            </div>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            Loading white dwarf papers...
        </div>
        
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
        let map;
        let markersLayer;
        let allPapers = [];
        
        // Initialize the map
        function initMap() {
            map = L.map('map').setView([20, 0], 2);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© OpenStreetMap contributors'
            }).addTo(map);
            
            markersLayer = L.layerGroup().addTo(map);
        }
        
        // Sample data for demonstration (in a real implementation, this would come from NASA ADS API)
        function generateSampleData() {
            const institutions = [
                { name: "Harvard-Smithsonian Center for Astrophysics", lat: 42.3601, lng: -71.0589, country: "USA" },
                { name: "European Southern Observatory", lat: 48.2642, lng: -24.6272, country: "Chile" },
                { name: "Max Planck Institute for Astrophysics", lat: 48.2608, lng: 11.6795, country: "Germany" },
                { name: "University of Cambridge", lat: 52.2053, lng: 0.1218, country: "UK" },
                { name: "Australian National University", lat: -35.2777, lng: 149.1185, country: "Australia" },
                { name: "University of Tokyo", lat: 35.7128, lng: 139.7619, country: "Japan" },
                { name: "Tel Aviv University", lat: 32.1133, lng: 34.8006, country: "Israel" },
                { name: "University of Cape Town", lat: -33.9577, lng: 18.4615, country: "South Africa" },
                { name: "Indian Institute of Astrophysics", lat: 13.0210, lng: 77.5658, country: "India" },
                { name: "University of SÃ£o Paulo", lat: -23.5629, lng: -46.7319, country: "Brazil" }
            ];
            
            const titles = [
                "White dwarf masses in cataclysmic variables",
                "Magnetic field evolution in isolated white dwarfs",
                "Crystallization in white dwarf cores",
                "Type Ia supernovae from white dwarf mergers",
                "Pulsating white dwarfs in binary systems",
                "White dwarf atmospheres and composition",
                "Cooling ages of white dwarf stars",
                "White dwarf companions to millisecond pulsars",
                "Spectroscopic analysis of DA white dwarfs",
                "White dwarf pollution by planetary debris"
            ];
            
            const papers = [];
            for (let i = 0; i < 50; i++) {
                const institution = institutions[Math.floor(Math.random() * institutions.length)];
                const title = titles[Math.floor(Math.random() * titles.length)];
                const citations = Math.floor(Math.random() * 150);
                const year = 2020 + Math.floor(Math.random() * 5);
                
                papers.push({
                    title: title,
                    authors: [`Author ${i+1}`, `Co-author ${i+1}`],
                    year: year,
                    citations: citations,
                    institution: institution.name,
                    lat: institution.lat + (Math.random() - 0.5) * 0.5, // Add small random offset
                    lng: institution.lng + (Math.random() - 0.5) * 0.5,
                    country: institution.country,
                    bibcode: `2024ApJ...${900 + i}..${i+1}A`
                });
            }
            
            return papers;
        }
        
        // Get marker color and size based on citations
        function getMarkerStyle(citations) {
            let color, size;
            
            if (citations >= 100) {
                color = '#2ed573';
                size = 20;
            } else if (citations >= 50) {
                color = '#3742fa';
                size = 16;
            } else if (citations >= 10) {
                color = '#ffa502';
                size = 12;
            } else {
                color = '#ff4757';
                size = 8;
            }
            
            return { color, size };
        }
        
        // Update map with papers
        function updateMap(papers) {
            markersLayer.clearLayers();
            
            // Group papers by location
            const locationGroups = {};
            papers.forEach(paper => {
                const key = `${paper.lat.toFixed(2)},${paper.lng.toFixed(2)}`;
                if (!locationGroups[key]) {
                    locationGroups[key] = [];
                }
                locationGroups[key].push(paper);
            });
            
            // Create markers for each location
            Object.values(locationGroups).forEach(groupPapers => {
                const totalCitations = groupPapers.reduce((sum, paper) => sum + paper.citations, 0);
                const avgCitations = Math.round(totalCitations / groupPapers.length);
                const { color, size } = getMarkerStyle(totalCitations);
                
                const marker = L.circleMarker([groupPapers[0].lat, groupPapers[0].lng], {
                    radius: size,
                    fillColor: color,
                    color: '#333',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.7
                }).addTo(markersLayer);
                
                // Create popup content
                let popupContent = `
                    <div class="paper-popup">
                        <h4>${groupPapers[0].institution}</h4>
                        <p><strong>Papers:</strong> ${groupPapers.length}</p>
                        <p><strong>Total Citations:</strong> <span class="citation-badge">${totalCitations}</span></p>
                        <p><strong>Avg Citations:</strong> ${avgCitations}</p>
                        <hr style="margin: 10px 0;">
                `;
                
                // Add top papers
                const sortedPapers = groupPapers.sort((a, b) => b.citations - a.citations).slice(0, 3);
                sortedPapers.forEach(paper => {
                    popupContent += `
                        <p><strong>${paper.title.substring(0, 50)}${paper.title.length > 50 ? '...' : ''}</strong></p>
                        <p>Citations: <span class="citation-badge">${paper.citations}</span> | Year: ${paper.year}</p>
                        <br>
                    `;
                });
                
                popupContent += '</div>';
                marker.bindPopup(popupContent);
            });
        }
        
        // Update statistics
        function updateStats(papers) {
            const totalPapers = papers.length;
            const totalCitations = papers.reduce((sum, paper) => sum + paper.citations, 0);
            const avgCitations = totalPapers > 0 ? Math.round(totalCitations / totalPapers) : 0;
            
            const institutions = new Set(papers.map(paper => paper.institution));
            const totalInstitutions = institutions.size;
            
            document.getElementById('totalPapers').textContent = totalPapers;
            document.getElementById('totalInstitutions').textContent = totalInstitutions;
            document.getElementById('totalCitations').textContent = totalCitations;
            document.getElementById('avgCitations').textContent = avgCitations;
        }
        
        // Filter papers based on controls
        function filterPapers(papers) {
            const yearRange = document.getElementById('yearRange').value.split('-');
            const minYear = parseInt(yearRange[0]);
            const maxYear = parseInt(yearRange[1]);
            const minCitations = parseInt(document.getElementById('minCitations').value) || 0;
            
            return papers.filter(paper => 
                paper.year >= minYear && 
                paper.year <= maxYear && 
                paper.citations >= minCitations
            );
        }
        
        // Fetch papers (demo version with sample data)
        async function fetchPapers() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            
            try {
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // In a real implementation, this would call the NASA ADS API
                // const response = await fetch('/api/nasa-ads-papers');
                // const papers = await response.json();
                
                // For demo purposes, use sample data
                allPapers = generateSampleData();
                
                const filteredPapers = filterPapers(allPapers);
                updateMap(filteredPapers);
                updateStats(filteredPapers);
                
            } catch (error) {
                document.getElementById('error').textContent = `Error fetching papers: ${error.message}`;
                document.getElementById('error').style.display = 'block';
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initMap();
            fetchPapers();
            
            // Add event listeners to controls
            document.getElementById('yearRange').addEventListener('change', () => {
                const filteredPapers = filterPapers(allPapers);
                updateMap(filteredPapers);
                updateStats(filteredPapers);
            });
            
            document.getElementById('minCitations').addEventListener('input', () => {
                const filteredPapers = filterPapers(allPapers);
                updateMap(filteredPapers);
                updateStats(filteredPapers);
            });
        });
        
        // Auto-refresh every 24 hours
        setInterval(fetchPapers, 24 * 60 * 60 * 1000);
    </script>
</body>
</html>